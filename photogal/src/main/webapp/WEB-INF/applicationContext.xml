<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd">

    <bean id="databaseDirectory" class="java.lang.String">
        <constructor-arg value="${db.dir}" />
    </bean>

    <bean id="databaseURL" class="java.lang.String">
        <constructor-arg value="jdbc:hsqldb:file:${db.dir}/photogal" />
    </bean>

    <bean id="imageFileAccessManager" class="org.sixcats.utils.FileAccessManager">
        <property name="baseDirectory" value="${images.dir}" />
    </bean>

    <bean id="scaledImageCalculator" class="net.sourceforge.photogal.image.ScaledImageCalculator">
        <property name="maxSizes">
            <map>
                <entry key="t">
                    <value type="java.lang.Integer">
                        ${scaledImage.maxSize.t}
					</value>
                </entry>
                <entry key="s">
                    <value type="java.lang.Integer">
                        ${scaledImage.maxSize.s}
					</value>
                </entry>
                <entry key="m">
                    <value type="java.lang.Integer">
                        ${scaledImage.maxSize.m}
					</value>
                </entry>
                <entry key="l">
                    <value type="java.lang.Integer">
                        ${scaledImage.maxSize.l}
					</value>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="scaledImageCache" class="net.sourceforge.photogal.image.ScaledImageCache">
        <property name="scaledImageCalculator" ref="scaledImageCalculator" />
        <property name="cacheDirectory" value="${scaledImage.cache.dir}" />
        <property name="imageScaler">
            <bean class="org.sixcats.utils.image.NobelImageScaler" />
        </property>
    </bean>

    <bean id="thumbnailGenerator" class="net.sourceforge.photogal.image.ThumbnailGenerator">
        <property name="fileAccessManager" ref="imageFileAccessManager" />
        <property name="scaledImageCache" ref="scaledImageCache" />
        <property name="throttleDelay" value="0" />
    </bean>

    <bean id="propertyPlaceholderConfigurer"
        class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location" value="/WEB-INF/applicationContext.properties" />
    </bean>

    <bean id="dataSource" class="org.hsqldb.jdbc.jdbcDataSource">
        <property name="database" ref="databaseURL" />
        <property name="user" value="sa" />
        <property name="password" value="" />
    </bean>

    <bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="mappingResources">
            <list>
                <value>net/sourceforge/photogal/Gallery.hbm.xml</value>
                <value>net/sourceforge/photogal/ImageDescriptor.hbm.xml</value>
            </list>
        </property>
        <property name="cacheProvider">
            <bean class="org.hibernate.cache.NoCacheProvider" />
        </property>
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.HSQLDialect</prop>
                <prop key="hibernate.show_sql">true</prop>
            </props>
        </property>
    </bean>

    <bean id="txManager"
        class="org.springframework.orm.hibernate3.HibernateTransactionManager">
        <property name="sessionFactory" ref="sessionFactory" />
    </bean>

    <bean id="photogalDao" class="net.sourceforge.photogal.hibernate.HibernatePhotogalDao">
        <property name="sessionFactory" ref="sessionFactory" />
    </bean>

    <bean id="timerFactory" class="org.springframework.scheduling.timer.TimerFactoryBean">
        <property name="scheduledTimerTasks">
            <bean class="org.springframework.scheduling.timer.ScheduledTimerTask">
                <property name="runnable" ref="thumbnailGenerator" />
                <property name="period" value="60000" />
            </bean>
        </property>
    </bean>
</beans>